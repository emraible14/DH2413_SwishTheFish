<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebSocket Client</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 600px;
        margin: 50px auto;
        padding: 20px;
        background-color: #f5f5f5;
      }
      .container {
        background-color: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        text-align: center;
      }
      .status {
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
        font-weight: bold;
      }
      .connected {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .disconnected {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
      .input-group {
        margin: 20px 0;
      }
      label {
        display: block;
        margin-bottom: 5px;
        font-weight: bold;
        color: #555;
      }
      input[type="text"] {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 16px;
        box-sizing: border-box;
      }
      button {
        background-color: #007bff;
        color: white;
        padding: 12px 24px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
        margin: 10px 5px;
      }
      button:hover {
        background-color: #0056b3;
      }
      button:disabled {
        background-color: #6c757d;
        cursor: not-allowed;
      }
      .messages {
        margin-top: 20px;
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 5px;
        max-height: 300px;
        overflow-y: auto;
      }
      .message {
        margin: 5px 0;
        padding: 5px;
        background-color: white;
        border-radius: 3px;
        border-left: 3px solid #007bff;
      }
      .message.sent {
        border-left-color: #28a745;
      }
      .message.received {
        border-left-color: #ffc107;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>WebSocket Client</h1>

      <div id="status" class="status disconnected">Disconnected</div>
      <div>
        <button id="sendBtn" onclick="sendMessage()" disabled>Add Fish</button>
      </div>

      <div>
        <button id="sendIntervalBtn" onclick="sendIntervalMessage()" disabled>
          Add Fish Every Second
        </button>
      </div>

      <div class="messages" id="messages">
        <div class="message">Ready to connect...</div>
      </div>
    </div>

    <script>
      let ws = null;
      let intervalId = null;
      const statusDiv = document.getElementById("status");
      const sendBtn = document.getElementById("sendBtn");
      const messagesDiv = document.getElementById("messages");
      const sendIntervalBtn = document.getElementById("sendIntervalBtn");
      function updateStatus(connected) {
        if (connected) {
          statusDiv.textContent = "Connected to WebSocket Server";
          statusDiv.className = "status connected";
          sendBtn.disabled = false;
          sendIntervalBtn.disabled = false;
        } else {
          statusDiv.textContent = "Disconnected";
          statusDiv.className = "status disconnected";
          sendBtn.disabled = true;
          sendIntervalBtn.disabled = true;
        }
      }

      function addMessage(content, type = "info") {
        const messageDiv = document.createElement("div");
        messageDiv.className = `message ${type}`;
        messageDiv.textContent = content;
        messagesDiv.appendChild(messageDiv);
        messagesDiv.scrollTop = messagesDiv.scrollHeight;
      }

      function connect() {
        try {
          ws = new WebSocket("ws://130.229.164.177:3001");

          ws.onopen = function () {
            updateStatus(true);
            addMessage("Connected to WebSocket server", "received");
          };

          ws.onmessage = function (event) {
            if (typeof event.data === "string") {
              addMessage(`Received: ${event.data}`, "received");
            } else {
              // Handle binary data
              const bytes = Array.from(new Uint8Array(event.data));
              addMessage(`Received binary: [${bytes.join(", ")}]`, "received");
            }
          };

          ws.onclose = function () {
            updateStatus(false);
            addMessage("Disconnected from WebSocket server", "info");
          };

          ws.onerror = function (error) {
            const errorDetails = {
              type: error.type || "WebSocket Error",
              message: error.message || "Connection failed",
              code: error.code || "Unknown",
              reason: error.reason || "No reason provided",
              wasClean: error.wasClean || false,
              target: error.target ? "WebSocket" : "Unknown",
              timeStamp: new Date().toISOString(),
              userAgent: navigator.userAgent,
            };

            addMessage(`Error: ${errorDetails.message}`, "info");
            addMessage(
              `Error Details: ${JSON.stringify(errorDetails, null, 2)}`,
              "info"
            );
            updateStatus(false);
          };
        } catch (error) {
          const errorDetails = {
            type: "Connection Error",
            message: error.message || "Unknown error",
            name: error.name || "Error",
            stack: error.stack || "No stack trace",
            timeStamp: new Date().toISOString(),
            userAgent: navigator.userAgent,
          };

          addMessage(`Connection error: ${errorDetails.message}`, "info");
          addMessage(
            `Error Details: ${JSON.stringify(errorDetails, null, 2)}`,
            "info"
          );
          updateStatus(false);
        }
      }

      function disconnect() {
        if (ws) {
          ws.close();
          ws = null;
        }
      }

      function sendMessage() {
        if (ws && ws.readyState === WebSocket.OPEN) {
          ws.send("addFish");
          addMessage(`Sent: addFish`, "sent");
        }
      }

      function sendIntervalMessage() {
        const button = document.getElementById("sendIntervalBtn");
        intervalId = setInterval(() => {
          sendMessage();
        }, 1000);

        button.textContent = "Stop Adding Fish Every Second";
        button.onclick = function () {
          stopIntervalMessage();
        };
      }

      function stopIntervalMessage() {
        if (intervalId) {
          clearInterval(intervalId);
          intervalId = null;
          const button = document.getElementById("sendIntervalBtn");
          button.textContent = "Add Fish Every Second";
          button.onclick = function () {
            sendIntervalMessage();
          };
        }
      }

      // Initialize
      connect();
    </script>
  </body>
</html>
